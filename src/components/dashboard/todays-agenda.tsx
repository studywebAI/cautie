
'use client';

import { useMemo } from 'react';
import { format, isToday, parseISO } from 'date-fns';
import type { ClassAssignment, ClassInfo, PersonalTask } from '@/contexts/app-context';
import { BrainCircuit, BookCheck } from 'lucide-react';
import { Button } from '../ui/button';
import Link from 'next/link';

type TodaysAgendaProps = {
  assignments: ClassAssignment[];
  personalTasks: PersonalTask[];
  classes: ClassInfo[];
};

export function TodaysAgenda({ assignments, personalTasks, classes }: TodaysAgendaProps) {
  const todaysEvents = useMemo(() => {
    const assignmentEvents = assignments
      .filter(a => a.due_date && isToday(parseISO(a.due_date)))
      .map(a => {
        const className = classes.find(c => c.id === a.class_id)?.name || 'Class';
        return {
          id: a.id,
          title: a.title,
          subject: className,
          type: 'assignment' as const,
        };
      });

    const personalEvents = personalTasks
      .filter(t => t.date && isToday(parseISO(t.date)))
      .map(t => ({
        id: t.id,
        title: t.title,
        subject: t.subject || 'Personal',
        type: 'personal' as const,
      }));

    return [...assignmentEvents, ...personalEvents];
  }, [assignments, personalTasks, classes]);

  if (todaysEvents.length === 0) {
    return (
      <div className="text-center text-muted-foreground p-4">
        <p>You have nothing scheduled for today.</p>
        <Button variant="link" asChild className="mt-2">
          <Link href="/agenda">Go to Agenda to add tasks</Link>
        </Button>
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {todaysEvents.map(event => (
        <div key={event.id} className="p-3 bg-muted/50 rounded-lg border-l-4"
             style={{ borderColor: `hsl(var(--${event.type === 'assignment' ? 'destructive' : 'primary'}))` }}>
          <div className='flex justify-between items-start'>
            <div>
              <p className="font-semibold">{event.title}</p>
              <p className="text-sm text-muted-foreground">{event.subject}</p>
            </div>
            {event.type === 'assignment'
              ? <BookCheck className="h-4 w-4 text-destructive flex-shrink-0" />
              : <BrainCircuit className="h-4 w-4 text-primary flex-shrink-0" />}
          </div>
        </div>
      ))}
    </div>
  );
}

    